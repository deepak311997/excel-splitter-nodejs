<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
    <title>Excel Splitter</title>
    <meta http-equiv="X-UA-Compatible" name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <style media="screen">
        ::-webkit-scrollbar {
            width: 6px !important;
            height: 6px !important;
        }

        ::-webkit-scrollbar-track {
            border-radius: 8px !important;
            background: #fff;
        }

        ::-webkit-scrollbar-thumb {
            background: #b5b5b5 !important;
            border-radius: 10px !important;
        }

        ::-webkit-scrollbar-thumb:horizontal {
            background: #b5b5b5 !important;
            border-radius: 10px !important;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #999999 !important;
        }
    </style>
    <script>
        function onSubmit(abc) {
            document.getElementById('submit').disabled = true;
            document.querySelector('.loading').style.display = "block";
            var xhr = new XMLHttpRequest();

            xhr.open("POST", "/api/process");
            xhr.responseType = 'blob';
            xhr.onload = function ({ target: { response, status }}) {
                document.getElementById('submit').disabled = false;
                document.querySelector('.loading').style.display = "none";
                const fileName = document.getElementById('output').value;
                
                if (status === 200) {
                    var blob = new Blob([event.target.response], { type: 'application/zip' });
                    var link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = fileName ? `${fileName}.zip` : 'result.zip';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert(`${status}: ${response}`);
                }
            };
            var formData = new FormData(document.getElementById("excel-form"));
            xhr.send(formData);
        }
    </script>
</head>
<body>
    <div class="app-container">
        <div class='ripple-background'>
            <div class='circle xxlarge shade1'></div>
            <div class='circle xlarge shade2'></div>
            <div class='circle large shade3'></div>
            <div class='circle medium shade4'></div>
            <div class='circle small shade5'></div>
        </div>
        <div class="container">
            <h3>Excel Splitter</h3>
            <form id="excel-form" method="post" enctype="multipart/form-data" onsubmit="return false;">
                <div>
                    <span>Upload input file: </span>
                    <input type="file" id="excel" name="excel" accept=".xls,.xlsx" />
                </div>
                <div>
                    <span>Split type: </span>
                    <span>
                        <input type="radio" id="category" name="type" value="category" />
                        <span>Category</span>
                        <input type="radio" id="manager" name="type" value="manager" />
                        <span>Manager</span>
                    </span>
                </div>
                <div>
                    <span>Date: </span>
                    <input type="text" id="date" name="date" />
                </div>
                <div>
                    <span>Output zip name: </span>
                    <input type="text" id="output" name="output" class="output-path" value="result"/>
                </div>
                <div>
                    <span>Select theme: </span>
                    <select id="theme" name="theme">
                        <option value="TableStyleLight9" selected>Blue Light 9</option>
                        <option value="TableStyleLight10">Orange Light 10</option>
                        <option value="TableStyleLight11">White Light 11</option>
                        <option value="TableStyleLight12">Gold Light 12</option>
                        <option value="TableStyleLight13">Blue Light 13</option>
                        <option value="TableStyleLight14">Green Light 14</option>
                    </select>
                </div>
                <div>
                    <button id="submit" onclick="onSubmit()">Submit</button>
                </div>
            </form>
            <div class="loading" style="display: none;"></div>
        </div>
    </div>
    <footer>
        <div class="footer-copyright text-center py-3">Â© 2020 Copyright:
            <a class="link" href="http://localhost:3000/">Excel Splitter</a>
            <span>by Deepak V</span>
        </div>
    </footer>
    <!-- Prompt a message in the browser if users disabled JS -->
    <noscript>Your browser does not support JavaScript!</noscript>
</body>

</html>